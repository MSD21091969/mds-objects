VPrompt voor Code Assistent:

Voer de volgende refactoring uit voor de google_drive toolset om deze aan te passen aan de nieuwe, per-request authenticatiestructuur.

Instructies:

Pas service.py aan:

Bestand: src/components/toolsets/google_workspace/drive/service.py

Wijzigingen:

Importeer de GoogleCredentialManager in plaats van de DatabaseManager.

Pas de __init__ methode aan om een credential_manager: GoogleCredentialManager te accepteren in plaats van een db_manager.

Vervang in alle methoden de aanroep service = await self.get_service_for_user(user_id) door service = await self.get_service(user_id).

Refactor google_drive_toolset.py:

Bestand: src/components/toolsets/google_workspace/drive/google_drive_toolset.py

Wijzigingen:

Voeg de _get_user_id_from_context helper-methode toe om de user_id uit de tool_context te halen.

Zorg ervoor dat elke tool-methode (list_files, upload_file, etc.) de tool_context: ToolContext parameter accepteert.

Roep in elke tool-methode de _get_user_id_from_context aan het begin aan om de user_id te verkrijgen.

Geef de user_id door aan de corresponderende aanroep van de drive_service (bv. await self._drive_service.list_files(user_id=user_id, ...)).

Implementeer foutafhandeling voor het geval er geen user_id gevonden kan worden.

Verifieer models.py:

Bestand: src/components/toolsets/google_workspace/drive/models.py

Actie: Controleer of dit bestand enkel het DriveFile Pydantic-model bevat. Er zijn hier geen aanpassingen nodig.